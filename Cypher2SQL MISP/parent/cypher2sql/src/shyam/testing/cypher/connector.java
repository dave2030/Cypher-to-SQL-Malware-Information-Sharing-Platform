package cypher;

import java.sql.Connection;
import java.io.File;

import org.apache.commons.io.FileUtils;
import org.cytosm.common.gtop.RelationalGTopInterface;
import org.cytosm.cypher2sql.PassAvailables;

import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Date;

public class connector {

	private static Connection connect = null;// All these variables are static since they are all the same for all
												// methods (no change and same values used)
	private static Statement statement = null;
	final private static String host = "127.0.0.1";
	final private static String user = "root";
	final private static String passwd = "password";
	final private static String database = "misp";

	public void connectToDB() throws Exception {
		try {

			// This will load the MySQL driver, each DB has its own driver
			Class.forName("com.mysql.jdbc.Driver");
			// Setup the connection with the DB
			String mysqlUrl = "jdbc:mysql://localhost/misp";
			connect = DriverManager.getConnection(mysqlUrl, "root", "password");
			System.out.println("Connection established......");// This tells us that the connection is established
			statement = connect.createStatement();
		} catch (Exception e) {// An error has occured
			throw e;
		}
	}

	public void printTables() throws Exception {// Prints all the events in the MISP Database
		// Retrieving the tables
		System.out.println("-----------");
		ResultSet res = statement.executeQuery("Show tables");
		System.out.println("Tables in the current database: ");
		while (res.next()) {
			System.out.print(res.getString(1));
			System.out.println();
		}

	}

	public void printEvents(String sql) throws Exception {// Prints all the events in the database and their info shown
															// below
		System.out.println("-----------");

		ResultSet ls = statement.executeQuery(sql);
		// extract data from result set
		System.out.println("Events");
		while (ls.next()) {

			int id = ls.getInt("a.id");
			String date = ls.getString("a.date");
			String info = ls.getString("a.info");
			int user_id = ls.getInt("a.user_id");
			System.out.println("ID: " + id + " Date: " + date + " Info: " + info + " User_id: " + user_id);

		}

	}

	public void printAttributes(String sql) throws Exception {// Prints all the attributes in the database and their
																// info shown
		
		System.out.println("-----------");

		ResultSet ls = statement.executeQuery(sql);
// extract data from result set
		System.out.println("Attributes");
		while (ls.next()) {

			int id = ls.getInt("a.id");
			int event_id = ls.getInt("a.event_id");
			String category = ls.getString("a.category");
			System.out.println("ID: " + id + " Event_ID: " + event_id + " Category: " + category);

		}

	}

	public void printThreadIndicator() throws Exception {// Shows the threat indicator and labellings
		System.out.println("-----------");
		System.out.println("Threats");
		String sql = "SELECT * from threat_levels";
		ResultSet ls = statement.executeQuery(sql);
		// Extract data from result set
		while (ls.next()) {
			// Retrieve by column name
			int id = ls.getInt("id");
			String name = ls.getString("name");
			String desc = ls.getString("description");
			String fdesc = ls.getString("form_description");
			System.out.println("ID: " + id + " Name: " + name + " Desc: " + desc + " form_desc: " + fdesc);
		}
	}

	public void extractUsers() throws Exception {// Returns user information and details about access to the database
													// (helpful for security purposes)
		System.out.println("-----------");
		System.out.println("Users ");
		String sql = "SELECT * from users";
		ResultSet ls = statement.executeQuery(sql);
		// Extract data from result set
		while (ls.next()) {
			// Retrieve by column name
			int id = ls.getInt("id");
			String pass = ls.getString("password");
			String email = ls.getString("email");
			String date = ls.getString("date_created");
			System.out.println("ID: " + id + " password: " + pass + " email: " + email + " date-created: " + date);
		}
	}

	public void close() throws Exception {// Closing off the database
		System.out.println("Statement Closed");
		System.out.println("Connection Closed");
		System.out.println("Goodbye");

		connect = null;
		statement = null;

	}

}